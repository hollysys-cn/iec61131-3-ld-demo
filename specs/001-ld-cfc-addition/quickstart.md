# å¿«é€Ÿå¼€å§‹ï¼šIEC61131-3 å›¾å½¢åŒ–ç¼–ç¨‹åŠ æ³•æ¼”ç¤º

**é€‚ç”¨äººå‘˜**: æ–°åŠ å…¥é¡¹ç›®çš„å¼€å‘è€…
**é¢„è®¡æ—¶é—´**: 30 åˆ†é’Ÿ
**å‰ç½®è¦æ±‚**: äº†è§£ JavaScriptã€HTML/CSS åŸºç¡€çŸ¥è¯†

---

## ç›®æ ‡

å®Œæˆæœ¬æŒ‡å—åï¼Œæ‚¨å°†èƒ½å¤Ÿï¼š

1. âœ… åœ¨æœ¬åœ°æˆåŠŸè¿è¡Œé¡¹ç›®
2. âœ… ç†è§£é¡¹ç›®æ¶æ„å’Œä»£ç ç»„ç»‡
3. âœ… åˆ›å»ºä¸€ä¸ªç®€å•çš„ LD åŠ æ³•ç¨‹åºå¹¶è¿è¡Œ
4. âœ… ä¿®æ”¹ä»£ç å¹¶éªŒè¯æ›´æ”¹

---

## ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

### 1.1 å®‰è£… Node.js

è®¿é—® [Node.js å®˜ç½‘](https://nodejs.org/) ä¸‹è½½å¹¶å®‰è£… **Node.js 18 LTS** æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

éªŒè¯å®‰è£…ï¼š

```bash
node --version  # åº”æ˜¾ç¤º v18.x.x æˆ–æ›´é«˜
npm --version   # åº”æ˜¾ç¤º 9.x.x æˆ–æ›´é«˜
```

### 1.2 é…ç½®å›½å†… npm é•œåƒï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# ä½¿ç”¨æ·˜å®é•œåƒåŠ é€Ÿä¾èµ–ä¸‹è½½
npm config set registry https://registry.npmmirror.com

# éªŒè¯é…ç½®
npm config get registry
```

### 1.3 å…‹éš†ä»£ç ä»“åº“

```bash
git clone https://github.com/hollysys-cn/iec61131-3-ld-demo.git
cd iec61131-3-ld-demo
git checkout 001-ld-cfc-addition
```

---

## ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

```bash
cd frontend
npm install
```

**é¢„è®¡æ—¶é—´**: 2-5 åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

**å¸¸è§é—®é¢˜**:
- å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°è¯•åˆ é™¤ `node_modules` å’Œ `package-lock.json` åé‡æ–°å®‰è£…
- å¦‚æœå›½å¤–æºæ…¢ï¼Œç¡®è®¤å·²é…ç½®æ·˜å®é•œåƒï¼ˆæ­¥éª¤ 1.2ï¼‰

---

## ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

**æˆåŠŸæç¤º**:
```
  VITE v4.x.x  ready in 500 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: http://192.168.x.x:5173/
```

æ‰“å¼€æµè§ˆå™¨è®¿é—® [http://localhost:5173/](http://localhost:5173/)ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°é¡¹ç›®é¦–é¡µã€‚

---

## ç¬¬å››æ­¥ï¼šé¡¹ç›®ç»“æ„å¯¼è§ˆ

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/         # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ editor/         # å›¾å½¢ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ monitor/        # ç›‘æ§ç•Œé¢
â”‚   â”‚   â””â”€â”€ common/         # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹ï¼ˆProgramProject, Variableç­‰ï¼‰
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ compiler/       # ç¼–è¯‘å™¨ï¼ˆLD/CFC â†’ JavaScriptï¼‰
â”‚   â”‚   â”œâ”€â”€ runtime/        # æ‰§è¡Œå¼•æ“
â”‚   â”‚   â””â”€â”€ storage/        # æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ App.vue             # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.js             # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â””â”€â”€ package.json            # ä¾èµ–é…ç½®
```

**å…³é”®æ–‡ä»¶è¯´æ˜**:

| æ–‡ä»¶ | ä½œç”¨ | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| `src/models/ProgramModel.js` | å®šä¹‰ç¨‹åºæ•°æ®ç»“æ„ | â­â­â­ |
| `src/services/compiler/LDCompiler.js` | LD ç¼–è¯‘å™¨æ ¸å¿ƒé€»è¾‘ | â­â­â­ |
| `src/services/runtime/Executor.js` | ç¨‹åºæ‰§è¡Œå¼•æ“ | â­â­â­ |
| `src/components/editor/LadderEditor.vue` | LD å›¾å½¢ç¼–è¾‘å™¨ UI | â­â­ |

---

## ç¬¬äº”æ­¥ï¼šåˆ›å»ºç¬¬ä¸€ä¸ª LD ç¨‹åº

### 5.1 é€šè¿‡ UI åˆ›å»º

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® [http://localhost:5173/](http://localhost:5173/)
2. ç‚¹å‡»"æ–°å»ºç¨‹åº"æŒ‰é’®
3. é€‰æ‹©"LDï¼ˆæ¢¯å½¢å›¾ï¼‰"ç±»å‹
4. è¾“å…¥ç¨‹åºåç§°ï¼š"æˆ‘çš„ç¬¬ä¸€ä¸ªåŠ æ³•ç¨‹åº"
5. ç‚¹å‡»"ç¡®å®š"

### 5.2 æ·»åŠ å˜é‡

1. åœ¨å·¦ä¾§é¢æ¿ç‚¹å‡»"æ·»åŠ å˜é‡"
2. è¾“å…¥å˜é‡å `input1`ï¼Œç±»å‹ `INT`ï¼Œæ–¹å‘ `INPUT`ï¼Œé»˜è®¤å€¼ `5`
3. é‡å¤æ­¥éª¤åˆ›å»º `input2`ï¼ˆINPUT, é»˜è®¤å€¼ `3`ï¼‰
4. åˆ›å»º `output`ï¼ˆOUTPUTï¼Œé»˜è®¤å€¼ `0`ï¼‰

### 5.3 æ·»åŠ åŠŸèƒ½å—

1. ä»å·¥å…·æ æ‹–æ‹½"ADD åŠŸèƒ½å—"åˆ°ç”»å¸ƒ
2. è¿æ¥ `input1` åˆ° ADD çš„ç¬¬ä¸€ä¸ªè¾“å…¥
3. è¿æ¥ `input2` åˆ° ADD çš„ç¬¬äºŒä¸ªè¾“å…¥
4. è¿æ¥ ADD çš„è¾“å‡ºåˆ° `output`

### 5.4 ç¼–è¯‘å¹¶è¿è¡Œ

1. ç‚¹å‡»"ç¼–è¯‘"æŒ‰é’®
2. å¦‚æœç¼–è¯‘æˆåŠŸï¼Œç‚¹å‡»"è¿è¡Œ"æŒ‰é’®
3. è§‚å¯Ÿç›‘æ§çª—å£ï¼Œ`output` åº”æ˜¾ç¤º `8`ï¼ˆ5 + 3ï¼‰

### 5.5 æµ‹è¯•å®æ—¶æ›´æ–°

1. åœ¨ç›‘æ§çª—å£ä¿®æ”¹ `input1` ä¸º `10`
2. `output` åº”ç«‹å³æ›´æ–°ä¸º `13`ï¼ˆ10 + 3ï¼‰

---

## ç¬¬å…­æ­¥ï¼šæŸ¥çœ‹ç”Ÿæˆçš„ä»£ç 

### 6.1 æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåˆ‡æ¢åˆ°"æ§åˆ¶å°"æ ‡ç­¾ã€‚

### 6.2 æŸ¥çœ‹ç¼–è¯‘åçš„ JavaScript

ç¼–è¯‘æˆåŠŸåï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºç±»ä¼¼ä¿¡æ¯ï¼š

```javascript
[ç¼–è¯‘å™¨] ç¼–è¯‘æˆåŠŸ
function executeProgram(variables) {
  // åŠ æ³•é€»è¾‘
  const result = variables.input1 + variables.input2;

  // æº¢å‡ºæ£€æµ‹
  if (result > 32767 || result < -32768) {
    console.warn('æº¢å‡ºè­¦å‘Šï¼šç»“æœè¶…å‡º INT èŒƒå›´');
    variables.output = (result & 0xFFFF) - (result & 0x8000 ? 0x10000 : 0);
  } else {
    variables.output = result;
  }

  return variables;
}
```

---

## ç¬¬ä¸ƒæ­¥ï¼šä¿®æ”¹ä»£ç å¹¶æµ‹è¯•

### 7.1 ä¿®æ”¹æº¢å‡ºè­¦å‘Šæ¶ˆæ¯

1. åœ¨ VS Code ä¸­æ‰“å¼€ `frontend/src/services/runtime/OverflowDetector.js`
2. æ‰¾åˆ° `detectOverflow` æ–¹æ³•
3. ä¿®æ”¹è­¦å‘Šæ¶ˆæ¯æ–‡æœ¬
4. ä¿å­˜æ–‡ä»¶ï¼ˆVite ä¼šè‡ªåŠ¨çƒ­æ›´æ–°ï¼‰
5. åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ï¼šè®¾ç½® `input1 = 30000`, `input2 = 5000`
6. è§‚å¯Ÿæ–°çš„è­¦å‘Šæ¶ˆæ¯

### 7.2 æ·»åŠ æ—¥å¿—è¾“å‡º

åœ¨ `frontend/src/services/runtime/Executor.js` çš„ `execute` æ–¹æ³•å¼€å¤´æ·»åŠ ï¼š

```javascript
execute(program) {
  console.log('[æ‰§è¡Œå¼•æ“] å¼€å§‹æ‰§è¡Œç¨‹åº:', program.name);
  // ...åŸæœ‰ä»£ç 
}
```

ä¿å­˜åè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºã€‚

---

## ç¬¬å…«æ­¥ï¼šè¿è¡Œæµ‹è¯•

### 8.1 å•å…ƒæµ‹è¯•

```bash
npm run test:unit
```

**é¢„æœŸè¾“å‡º**:
```
 PASS  tests/unit/models/ProgramModel.test.js
 PASS  tests/unit/services/compiler/LDCompiler.test.js
 PASS  tests/unit/services/runtime/Executor.test.js

Test Suites: 3 passed, 3 total
Tests:       15 passed, 15 total
```

### 8.2 E2E æµ‹è¯•

```bash
npm run test:e2e
```

æµ‹è¯•ä¼šè‡ªåŠ¨å¯åŠ¨æµè§ˆå™¨å¹¶æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œã€‚

---

## ç¬¬ä¹æ­¥ï¼šç†è§£æ ¸å¿ƒæ¦‚å¿µ

### 9.1 æ•°æ®æ¨¡å‹

é˜…è¯» `specs/001-ld-cfc-addition/data-model.md` äº†è§£ï¼š
- ProgramProjectï¼ˆç¨‹åºé¡¹ç›®ï¼‰
- Variableï¼ˆå˜é‡ï¼‰
- FunctionBlockï¼ˆåŠŸèƒ½å—ï¼‰
- GraphicElementï¼ˆå›¾å½¢å…ƒç´ ï¼‰

### 9.2 ç¼–è¯‘æµç¨‹

```
LD å›¾å½¢ç¨‹åº â†’ JSON æ•°æ® â†’ AST åˆ†æ â†’ JavaScript ä»£ç ç”Ÿæˆ â†’ æ‰§è¡Œ
```

æ ¸å¿ƒæ–‡ä»¶ï¼š
- `src/services/compiler/LDCompiler.js` - ç¼–è¯‘å™¨å…¥å£
- `src/services/compiler/CodeGenerator.js` - ä»£ç ç”Ÿæˆ

### 9.3 äº‹ä»¶é©±åŠ¨æ¶æ„

å˜é‡å€¼æ›´æ–°æµç¨‹ï¼š

```
ç”¨æˆ·ä¿®æ”¹ input1
â†’ VariableStore è§¦å‘ 'change' äº‹ä»¶
â†’ Executor ç›‘å¬äº‹ä»¶å¹¶é‡æ–°è®¡ç®—
â†’ æ›´æ–° output å€¼
â†’ VariableMonitor ç›‘å¬äº‹ä»¶å¹¶æ›´æ–° UI
```

æ ¸å¿ƒæ–‡ä»¶ï¼š
- `src/services/runtime/VariableStore.js` - äº‹ä»¶é©±åŠ¨çš„å˜é‡å­˜å‚¨

---

## ç¬¬åæ­¥ï¼šä¸‹ä¸€æ­¥å­¦ä¹ 

### æ¨èé˜…è¯»é¡ºåº

1. âœ… **æœ¬æ–‡æ¡£**ï¼ˆå¿«é€Ÿå¼€å§‹ï¼‰ - æ‚¨å·²å®Œæˆï¼
2. ğŸ“– `specs/001-ld-cfc-addition/spec.md` - åŠŸèƒ½è§„æ ¼è¯´æ˜
3. ğŸ“– `specs/001-ld-cfc-addition/data-model.md` - æ•°æ®æ¨¡å‹è¯¦è§£
4. ğŸ“– `specs/001-ld-cfc-addition/plan.md` - å®ç°è®¡åˆ’
5. ğŸ“– `specs/001-ld-cfc-addition/research.md` - æŠ€æœ¯ç ”ç©¶

### å®è·µä»»åŠ¡

å®Œæˆä»¥ä¸‹ä»»åŠ¡å·©å›ºå­¦ä¹ ï¼š

- [ ] **ä»»åŠ¡ 1**: åˆ›å»ºä¸€ä¸ª CFC ç¨‹åºï¼ˆè€Œé LDï¼‰
- [ ] **ä»»åŠ¡ 2**: æµ‹è¯•æº¢å‡ºæƒ…å†µï¼ˆè¾“å…¥ 32000 + 1000ï¼‰
- [ ] **ä»»åŠ¡ 3**: æ·»åŠ ä¸€ä¸ªæ–°çš„å•å…ƒæµ‹è¯•
- [ ] **ä»»åŠ¡ 4**: åœ¨ç›‘æ§çª—å£æ·»åŠ å˜é‡å†å²è®°å½•æ˜¾ç¤º

### è´¡çŒ®ä»£ç 

å‡†å¤‡å¥½è´¡çŒ®ä»£ç äº†å—ï¼Ÿè¯·é˜…è¯»ï¼š
- `CONTRIBUTING.md` - è´¡çŒ®æŒ‡å—
- `.specify/memory/constitution.md` - é¡¹ç›®å®ªç« ï¼ˆç¼–ç è§„èŒƒï¼‰

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: ä¸ºä»€ä¹ˆé€‰æ‹© Vue 3 è€Œä¸æ˜¯ Reactï¼Ÿ

A: å‚è€ƒ `specs/001-ld-cfc-addition/research.md` ç¬¬ 2 èŠ‚ã€‚ä¸»è¦åŸå› ï¼šè½»é‡çº§ã€å“åº”å¼ç³»ç»Ÿã€ä¸­æ–‡æ–‡æ¡£ä¸°å¯Œã€‚

### Q2: å¦‚ä½•æ·»åŠ æ›´å¤šåŠŸèƒ½å—ç±»å‹ï¼ˆå¦‚ SUBã€MULï¼‰ï¼Ÿ

A: ç›®å‰ä»…æ”¯æŒ ADDã€‚æ‰©å±•éœ€è¦ï¼š
1. ä¿®æ”¹ `contracts/program-schema.json` çš„ `BlockType` æšä¸¾
2. åœ¨ `src/services/compiler/CodeGenerator.js` æ·»åŠ ç”Ÿæˆé€»è¾‘
3. åœ¨ `src/components/editor/` æ·»åŠ å¯¹åº”çš„ UI ç»„ä»¶

### Q3: ç¨‹åºæ–‡ä»¶ä¿å­˜åœ¨å“ªé‡Œï¼Ÿ

A: å½“å‰ä½¿ç”¨ localStorage API ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ã€‚ä¹Ÿå¯ä»¥é€šè¿‡"å¯¼å‡º"åŠŸèƒ½ä¸‹è½½ä¸º JSON æ–‡ä»¶ã€‚

### Q4: å¦‚ä½•è°ƒè¯•ç¼–è¯‘é”™è¯¯ï¼Ÿ

A:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ¶ˆæ¯
3. åœ¨ `src/services/compiler/LDCompiler.js` æ·»åŠ  `console.log`
4. ä½¿ç”¨ VS Code è°ƒè¯•åŠŸèƒ½ï¼ˆF5ï¼‰

### Q5: ä¸ºä»€ä¹ˆä½¿ç”¨ Fabric.js è€Œä¸æ˜¯åŸç”Ÿ Canvasï¼Ÿ

A: å‚è€ƒ `specs/001-ld-cfc-addition/research.md` ç¬¬ 1 èŠ‚ã€‚ä¸»è¦åŸå› ï¼šå‡å°‘å¼€å‘å·¥ä½œé‡ã€äº‹ä»¶ç³»ç»Ÿå®Œå–„ã€‚

---

## è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. ğŸ“– æŸ¥é˜… `specs/` ç›®å½•ä¸‹çš„æ–‡æ¡£
2. ğŸ” æœç´¢ GitHub Issues
3. ğŸ’¬ åœ¨é¡¹ç›®è®¨è®ºåŒºæé—®
4. ğŸ“§ è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æ­å–œï¼æ‚¨å·²å®Œæˆå¿«é€Ÿå¼€å§‹æŒ‡å—ã€‚** ğŸ‰

å¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªåŠŸèƒ½å¼€å‘å§ï¼å‚è€ƒ `specs/001-ld-cfc-addition/tasks.md` äº†è§£å¼€å‘ä»»åŠ¡æ¸…å•ã€‚
