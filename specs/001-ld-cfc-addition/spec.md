# Feature Specification: IEC61131-3 LD/CFC Addition Example

**Feature Branch**: `001-ld-cfc-addition`
**Created**: 2026-01-18
**Status**: Draft
**Input**: User description: "使用LD和CFC实现加法示例"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - LD Ladder Diagram Addition Program (Priority: P1)

作为工业自动化工程师，我需要使用 IEC61131-3 LD（梯形图）图形化编程语言创建一个简单的加法程序示例，以便学习和演示如何使用梯形图实现基本算术运算。

**Why this priority**: 这是最核心的演示需求，展示了如何使用 LD 梯形图语言实现基本算术操作。完成这个故事就能提供一个完整可用的演示示例。

**Independent Test**: 可以通过查看 LD 程序文件，验证是否包含两个输入变量和一个输出变量的定义，以及正确的加法功能块连接。通过手动执行程序逻辑，验证 Input1=5, Input2=3 时输出是否为 8。

**Acceptance Scenarios**:

1. **Given** 需要创建一个 LD 加法示例，**When** 定义两个整数类型输入变量（A 和 B）和一个整数类型输出变量（Result），**Then** 变量定义应该清晰明确，符合 IEC61131-3 标准
2. **Given** 变量已定义，**When** 在 LD 梯形图中添加加法功能块，**Then** 功能块应正确连接两个输入变量到加法块的输入端，输出端连接到结果变量
3. **Given** LD 程序已完成，**When** 设置 A=10, B=20，**Then** Result 应计算为 30
4. **Given** LD 程序示例，**When** 修改输入值（A=15, B=25），**Then** Result 应更新为 40

---

### User Story 2 - CFC Continuous Function Chart Addition Program (Priority: P2)

作为工业自动化工程师，我需要使用 IEC61131-3 CFC（连续功能图）图形化编程语言创建相同功能的加法程序示例，以便对比学习 LD 和 CFC 两种不同的图形化编程方式。

**Why this priority**: 提供第二种图形化编程语言的示例，帮助用户理解和对比 LD 与 CFC 的表达方式差异。可以在 P1 完成后独立实现。

**Independent Test**: 查看 CFC 程序文件，验证功能块图的结构是否正确，输入输出是否正确连接。通过手动执行逻辑验证计算结果的正确性。

**Acceptance Scenarios**:

1. **Given** 需要创建 CFC 加法示例，**When** 定义相同的输入输出变量，**Then** 变量定义应与 LD 示例保持一致
2. **Given** 变量已定义，**When** 在 CFC 编辑器中添加 ADD 功能块并连接数据流，**Then** 应形成清晰的数据流向图
3. **Given** CFC 程序已完成，**When** 设置输入 A=7, B=8，**Then** 输出 Result 应为 15
4. **Given** 两个示例程序（LD 和 CFC），**When** 对比它们的结构，**Then** 应该能够清楚看出两种编程方式的表达差异

---

### Edge Cases

- 当输入值超出INT类型范围（-32768到32767）时，示例应该展示如何定义适当的数据类型约束
- 当输入为负数时，加法运算应该正确处理（如 A=-5, B=3, Result=-2）
- 当加法结果溢出（超出-32768到32767范围）时，示例应该展示标准的回绕行为（wrap-around）并在文档中明确说明此行为
- 程序示例应该包含注释，说明各个元素的作用和连接关系

## Clarifications

### Session 2026-01-18

- Q: 程序示例文件的目标格式是什么？ → A: XML格式（符合PLCopen标准），可被主流IEC61131-3工具导入
- Q: 示例程序的交互方式是什么？ → A: 可交互运行（用户可修改输入值并查看输出结果）
- Q: INT数据类型的具体范围是多少？ → A: -32768 to 32767
- Q: 当加法结果溢出时的处理方式是什么？ → A: 按标准回绕行为（wrap-around），示例中说明此行为
- Q: 示例程序应支持哪些目标开发环境？ → A: 支持主流PLCopen兼容工具（CODESYS、TIA Portal、CX-Programmer等）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 示例必须包含符合 IEC61131-3 第3版标准的 LD（梯形图）程序
- **FR-002**: 示例必须包含符合 IEC61131-3 第3版标准的 CFC（连续功能图）程序
- **FR-003**: 两个示例程序必须实现相同的加法功能：两个INT类型整数（范围-32768到32767）相加得到结果
- **FR-004**: 程序必须定义至少两个输入变量和一个输出变量
- **FR-005**: LD 示例必须使用梯形图的标准图形符号表示加法逻辑
- **FR-006**: CFC 示例必须使用功能块图的标准符号表示加法逻辑
- **FR-007**: 程序必须包含清晰的注释，说明变量用途和逻辑流程，注释覆盖率达到100%（每个变量和功能块都有说明）
- **FR-008**: 示例必须展示输入数据如何流经功能块到达输出
- **FR-009**: 程序文件必须使用PLCopen XML格式，能够被主流PLCopen兼容工具（如CODESYS、TIA Portal、CX-Programmer等）读取和导入
- **FR-010**: 示例必须包含测试用例，展示不同输入值下的预期输出结果
- **FR-011**: 示例必须支持交互式运行，允许用户在IEC61131-3开发工具（如CODESYS、TIA Portal）中手动修改输入变量值并重新运行程序以查看输出结果的变化
- **FR-012**: 示例必须在文档中说明溢出时的标准回绕行为（wrap-around），当结果超出INT范围时的处理方式

### Key Entities

- **Program File**: 表示一个完整的 LD 或 CFC 程序文件（PLCopen XML格式），包含程序类型标识、变量定义、图形化逻辑描述，可被主流开发工具导入
- **Variable**: 表示程序中的数据点，包含变量名称、数据类型（INT，范围-32768到32767）、用途说明（输入/输出）
- **Function Block**: 表示加法运算功能块，包含输入端口（2个）、输出端口（1个）、功能说明、溢出行为说明
- **Connection**: 表示变量与功能块之间的数据连接关系
- **Test Case**: 表示交互式测试场景，包含输入值设置、预期输出结果、溢出场景验证

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 工程师能够在 10 分钟内理解 LD 示例程序的结构和逻辑
- **SC-002**: 工程师能够在 10 分钟内理解 CFC 示例程序的结构和逻辑
- **SC-003**: 95% 的用户能够通过对比两个示例，说出 LD 和 CFC 的至少两个关键差异
- **SC-004**: 示例程序能够正确处理正整数、负整数和零的加法运算
- **SC-005**: 程序文件的注释覆盖率达到 100%（每个变量和功能块都有说明）
- **SC-006**: 用户能够基于示例程序，自行创建类似的减法或乘法程序

## Assumptions & Constraints

### Assumptions
- 用户具备基本的 PLC 编程知识，了解变量和功能块的概念
- 用户理解INT数据类型（16位有符号整数，范围-32768到32767）和基本算术运算
- 示例程序用于教学和演示目的，不用于实际工业生产环境
- 用户可以访问支持PLCopen XML格式的IEC61131-3开发工具

### 约束
- 本演示项目仅实现基础的加法功能，不涉及复杂的控制逻辑
- 数据类型仅支持 INT（16位有符号整数）
- 不涉及多线程或并发执行
- 不涉及与实际 PLC 硬件的通信

### 技术约束（基于项目宪章）
- 所有代码注释和文档必须使用简体中文
- 项目文件编码必须使用 UTF-8（无 BOM），换行符使用 LF
- 开发工具和依赖包优先从国内镜像源获取
- 新增的第三方依赖需经过人工审批确认许可协议
