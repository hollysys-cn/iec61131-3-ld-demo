# INT 数据类型溢出行为说明

## 概述

本文档说明 IEC61131-3 标准中 INT 数据类型的溢出行为（Overflow Behavior），这对于理解加法示例程序的边界情况至关重要。

## INT 数据类型规格

| 属性 | 值 |
|------|-----|
| **数据类型** | INT (Integer) |
| **位宽** | 16位有符号整数 |
| **最小值** | -32768 (0x8000) |
| **最大值** | 32767 (0x7FFF) |
| **二进制表示** | 补码（Two's Complement） |

## 溢出行为：回绕（Wrap-Around）

根据 IEC61131-3 第3版标准，INT 类型的算术运算采用**回绕（Wrap-Around）**行为，即当计算结果超出表示范围时，结果会"回绕"到另一端。

### 正向溢出（Positive Overflow）

当加法结果超过最大值 32767 时，结果会从最小值 -32768 开始计算。

**示例**：
```
32767 + 1 = -32768
32767 + 2 = -32767
32767 + 10 = -32759
```

**二进制解释**：
```
  32767 (0x7FFF) = 0111 1111 1111 1111
+     1 (0x0001) = 0000 0000 0000 0001
--------------------------------
 -32768 (0x8000) = 1000 0000 0000 0000  (溢出，最高位变为1，表示负数)
```

### 负向溢出（Negative Overflow）

当减法或负数相加的结果小于最小值 -32768 时，结果会从最大值 32767 开始计算。

**示例**：
```
-32768 - 1 = 32767
-32768 - 2 = 32766
-32768 - 10 = 32758
```

**二进制解释**：
```
 -32768 (0x8000) = 1000 0000 0000 0000
-     1 (0x0001) = 1111 1111 1111 1111  (补码表示-1)
--------------------------------
  32767 (0x7FFF) = 0111 1111 1111 1111  (溢出，最高位变为0，表示正数)
```

## 测试用例

加法示例程序包含以下溢出测试场景：

| 场景 | A | B | 期望结果 | 说明 |
|------|---|---|----------|------|
| **正常加法** | 10 | 20 | 30 | 无溢出 |
| **负数加法** | -5 | 3 | -2 | 无溢出 |
| **正向溢出** | 32767 | 1 | -32768 | 超过最大值，回绕到最小值 |
| **负向溢出** | -32768 | -1 | 32767 | 小于最小值，回绕到最大值 |
| **零值** | 0 | 0 | 0 | 边界情况 |

## 实际应用注意事项

### 1. 工业控制系统中的风险

在实际工业应用中，溢出回绕行为可能导致严重后果：
- **温度控制**：如果温度传感器读数接近上限，加上增量后溢出为负值，可能导致误判温度过低
- **位置控制**：电机位置计数器溢出可能导致错误的运动方向判断
- **时间计数**：计时器溢出可能导致时间逻辑错误

### 2. 防范措施

在实际项目中应采取以下措施：
- **边界检查**：在执行算术运算前检查是否会溢出
- **使用更大数据类型**：对于可能超出INT范围的场景，使用DINT（32位）或LINT（64位）
- **饱和运算**：实现饱和逻辑，将结果限制在有效范围内（例如：超过32767时保持32767）
- **异常标志**：设置溢出标志位，触发报警或保护逻辑

### 3. 示例代码：溢出检测

```iec61131-3
(* 带溢出检测的安全加法 *)
IF (A > 0) AND (B > 0) AND ((32767 - A) < B) THEN
    (* 正向溢出风险 *)
    OverflowFlag := TRUE;
    Result := 32767;  (* 饱和到最大值 *)
ELSIF (A < 0) AND (B < 0) AND ((-32768 - A) > B) THEN
    (* 负向溢出风险 *)
    OverflowFlag := TRUE;
    Result := -32768;  (* 饱和到最小值 *)
ELSE
    (* 安全范围内 *)
    OverflowFlag := FALSE;
    Result := A + B;
END_IF;
```

## 标准参考

- **IEC 61131-3 第3版**，第2.3.1节：数据类型
- **PLCopen XML v2.01** 规范，附录A：数据类型定义

## 总结

- INT 类型采用 16 位补码表示，范围 -32768 到 32767
- 溢出时采用回绕行为，不会产生错误或异常
- 本教学示例展示标准溢出行为，实际应用需要额外的保护逻辑
- 理解溢出行为是编写可靠工业控制程序的基础

---

**文档版本**: 1.0
**最后更新**: 2026-01-18
**语言**: 简体中文
