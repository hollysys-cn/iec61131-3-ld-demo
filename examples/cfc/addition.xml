<?xml version="1.0" encoding="UTF-8"?>
<!--
  IEC61131-3 CFC (Continuous Function Chart) 加法示例程序
  功能：演示使用连续功能图实现两个INT类型整数相加
  标准：IEC 61131-3 第3版，PLCopen XML v2.01
  创建日期：2026-01-18
  语言：简体中文
-->
<project xmlns="http://www.plcopen.org/xml/tc6_0201"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://www.plcopen.org/xml/tc6_0201
                             http://www.plcopen.org/xml/tc6_0201/TC6_XML_V201_IS.xsd">

  <fileHeader companyName="IEC61131-3 LD Demo Project"
              productName="CFC Addition Example"
              productVersion="1.0"
              creationDateTime="2026-01-18T00:00:00"
              contentDescription="CFC连续功能图加法示例程序 - 教学演示用">
    <coordinateInfo>
      <fbd>
        <scaling x="1" y="1"/>
      </fbd>
      <ld>
        <scaling x="1" y="1"/>
      </ld>
      <sfc>
        <scaling x="1" y="1"/>
      </sfc>
    </coordinateInfo>
  </fileHeader>

  <contentHeader name="Addition_CFC"
                 modificationDateTime="2026-01-18T00:00:00">
    <coordinateInfo>
      <pageSize x="800" y="600"/>
      <fbd>
        <scaling x="1" y="1"/>
      </fbd>
      <ld>
        <scaling x="1" y="1"/>
      </ld>
      <sfc>
        <scaling x="1" y="1"/>
      </sfc>
    </coordinateInfo>
  </contentHeader>

  <types>
    <dataTypes/>
    <pous>
      <!-- POU: Program Organization Unit - 程序组织单元 -->
      <pou name="Addition_CFC" pouType="program">
        <interface>
          <!-- 变量声明 -->
          <localVars>
            <variable name="A">
              <type>
                <INT/>
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  加数1：INT类型（16位有符号整数），范围 -32768 到 32767
                </xhtml>
              </documentation>
            </variable>
            <variable name="B">
              <type>
                <INT/>
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  加数2：INT类型（16位有符号整数），范围 -32768 到 32767
                </xhtml>
              </documentation>
            </variable>
            <variable name="Result">
              <type>
                <INT/>
              </type>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  和：存储A + B的计算结果（INT类型，可能发生溢出回绕）
                </xhtml>
              </documentation>
            </variable>
          </localVars>
        </interface>

        <body>
          <!-- FBD/CFC 功能块图逻辑 -->
          <FBD>
            <comment localId="1" height="80" width="500">
              <position x="50" y="20"/>
              <content>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  <![CDATA[
                  CFC连续功能图加法示例
                  功能：计算 Result = A + B
                  使用标准ADD功能块，数据流从左到右
                  特点：可视化数据流向，适合复杂控制逻辑
                  注意：当结果超出INT范围时会发生溢出回绕
                  ]]>
                </xhtml>
              </content>
            </comment>

            <!-- 输入变量A -->
            <inVariable localId="2">
              <position x="100" y="150"/>
              <connectionPointOut>
                <relPosition x="60" y="15"/>
              </connectionPointOut>
              <expression>A</expression>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  输入变量A：加数1
                </xhtml>
              </documentation>
            </inVariable>

            <!-- 输入变量B -->
            <inVariable localId="3">
              <position x="100" y="200"/>
              <connectionPointOut>
                <relPosition x="60" y="15"/>
              </connectionPointOut>
              <expression>B</expression>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  输入变量B：加数2
                </xhtml>
              </documentation>
            </inVariable>

            <!-- ADD 功能块 -->
            <block localId="4" typeName="ADD" instanceName="">
              <position x="250" y="130"/>
              <inputVariables>
                <variable formalParameter="IN1">
                  <connectionPointIn>
                    <relPosition x="0" y="30"/>
                    <connection refLocalId="2">
                      <position x="250" y="160"/>
                      <position x="220" y="160"/>
                      <position x="220" y="165"/>
                      <position x="160" y="165"/>
                    </connection>
                  </connectionPointIn>
                </variable>
                <variable formalParameter="IN2">
                  <connectionPointIn>
                    <relPosition x="0" y="60"/>
                    <connection refLocalId="3">
                      <position x="250" y="190"/>
                      <position x="220" y="190"/>
                      <position x="220" y="215"/>
                      <position x="160" y="215"/>
                    </connection>
                  </connectionPointIn>
                </variable>
              </inputVariables>
              <inOutVariables/>
              <outputVariables>
                <variable formalParameter="OUT">
                  <connectionPointOut>
                    <relPosition x="100" y="45"/>
                  </connectionPointOut>
                </variable>
              </outputVariables>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  <![CDATA[
                  ADD功能块：执行加法运算
                  - 输入1（IN1）：来自变量A
                  - 输入2（IN2）：来自变量B
                  - 输出（OUT）：计算结果 A + B

                  数据流：A ──→ IN1 ──┐
                          B ──→ IN2 ──┤ ADD ──→ Result
                  ]]>
                </xhtml>
              </documentation>
            </block>

            <!-- 输出变量Result -->
            <outVariable localId="5">
              <position x="450" y="175"/>
              <connectionPointIn>
                <relPosition x="0" y="0"/>
                <connection refLocalId="4" formalParameter="OUT">
                  <position x="450" y="175"/>
                  <position x="350" y="175"/>
                </connection>
              </connectionPointIn>
              <expression>Result</expression>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  输出变量Result：存储加法运算的结果
                </xhtml>
              </documentation>
            </outVariable>

            <comment localId="6" height="120" width="500">
              <position x="50" y="280"/>
              <content>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  <![CDATA[
                  数据流说明：
                  1. 变量A的值流向ADD功能块的IN1输入端
                  2. 变量B的值流向ADD功能块的IN2输入端
                  3. ADD功能块执行加法运算：OUT = IN1 + IN2
                  4. 运算结果从OUT输出端流向变量Result
                  5. 整个过程形成清晰的从左到右的数据流

                  CFC特点：
                  - 可视化数据流向（箭头表示数据传递方向）
                  - 功能块可自由布局（不受梯级约束）
                  - 适合复杂控制算法（如PID控制、多变量运算）

                  溢出行为：
                  - 当 A + B > 32767 时，结果回绕到负数
                  - 当 A + B < -32768 时，结果回绕到正数
                  详见：examples/shared/docs/overflow-behavior.md
                  ]]>
                </xhtml>
              </content>
            </comment>

            <comment localId="7" height="60" width="200">
              <position x="100" y="120"/>
              <content>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  输入数据源
                </xhtml>
              </content>
            </comment>

            <comment localId="8" height="60" width="150">
              <position x="230" y="60"/>
              <content>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  加法运算
                </xhtml>
              </content>
            </comment>

            <comment localId="9" height="60" width="150">
              <position x="410" y="120"/>
              <content>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">
                  输出结果
                </xhtml>
              </content>
            </comment>
          </FBD>
        </body>

        <documentation>
          <xhtml xmlns="http://www.w3.org/1999/xhtml">
            <![CDATA[
            <h2>CFC连续功能图加法示例程序</h2>
            <p><strong>功能</strong>：实现两个INT类型整数的加法运算</p>
            <p><strong>编程语言</strong>：CFC（Continuous Function Chart，连续功能图）</p>

            <h3>变量</h3>
            <ul>
              <li>A (INT)：加数1，范围 -32768 到 32767</li>
              <li>B (INT)：加数2，范围 -32768 到 32767</li>
              <li>Result (INT)：和，存储计算结果</li>
            </ul>

            <h3>逻辑</h3>
            <p>使用标准ADD功能块实现 Result = A + B</p>
            <p>数据流：A → ADD.IN1, B → ADD.IN2, ADD.OUT → Result</p>

            <h3>CFC与LD的对比</h3>
            <ul>
              <li><strong>LD（梯形图）</strong>：类似继电器逻辑，从左到右、从上到下扫描</li>
              <li><strong>CFC（功能图）</strong>：可视化数据流，功能块可自由布局</li>
              <li><strong>适用场景</strong>：CFC更适合复杂算术运算和控制算法</li>
            </ul>

            <h3>测试用例</h3>
            <p>参见 examples/cfc/test-cases.json</p>

            <h3>使用指南</h3>
            <p>参见 examples/cfc/addition.md</p>
            ]]>
          </xhtml>
        </documentation>
      </pou>
    </pous>
  </types>

  <instances>
    <configurations>
      <configuration name="Config">
        <resource name="Resource1">
          <task name="MainTask" priority="0" interval="T#100ms">
            <pouInstance name="Addition_CFC_Instance" typeName="Addition_CFC"/>
          </task>
        </resource>
      </configuration>
    </configurations>
  </instances>

</project>
